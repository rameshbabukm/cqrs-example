# Bank Account CQRS E2E Architecture Diagram

```
================================================================================
                        BANK ACCOUNT CQRS SYSTEM
================================================================================

┌─────────────────────────────────────────────────────────────────────────────┐
│                              USER INTERFACE                                │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        React Application                           │   │
│  │                    (account-ui : Port 3000)                        │   │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐     │   │
│  │  │  Account List   │  │  Add Account    │  │  Transactions    │     │   │
│  │  │   (Table View)  │  │   (Form)        │  │   (Deposit/      │     │   │
│  │  │                 │  │                 │  │    Withdraw)     │     │   │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      │ HTTP/HTTPS
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                             API GATEWAY                                   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                          Nginx Proxy                               │   │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐     │   │
│  │  │ /api/v1/bankAc- │  │ /api/v1/openBan-│  │ /api/v1/deposit- │     │   │
│  │  │ countLookup/*   │  │ kAccount        │  │ Funds/*         │     │   │
│  │  │ ──────────────▶ │  │ ──────────────▶ │  │ ──────────────▶ │     │   │
│  │  │ account-query   │  │ account-cmd     │  │ account-cmd     │     │   │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      │ Internal Network
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           CQRS ARCHITECTURE                               │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        COMMAND SIDE (WRITE)                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  │                    account-cmd (Port 5002)                      │   │
│  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐   │   │
│  │  │  │ OpenAccount     │  │ DepositFunds    │  │ WithdrawFunds    │   │
│  │  │  │ Controller      │  │ Controller      │  │ Controller      │   │
│  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘   │   │
│  │  │                           │         │         │                   │   │
│  │  │                           └─────────┼─────────┘                   │   │
│  │  │                                     │                             │   │
│  │  │                    ┌────────────────▼────────────────┐            │   │
│  │  │                    │       Command Dispatcher        │            │   │
│  │  │                    └────────────────▲────────────────┘            │   │
│  │  │                             │         │                           │   │
│  │  │  ┌─────────────────┐  ┌──────▼─────┐  ┌─────────────────┐         │   │
│  │  │  │ OpenAccount     │  │ BankAccount│  │ Event Store     │         │   │
│  │  │  │ Command Handler │  │ Aggregate  │  │ (MongoDB)       │         │   │
│  │  │  └─────────────────┘  └────────────┘  └─────────────────┘         │   │
│  │  └─────────────────────────────────────────────────────────────────────┘   │
│  │                           │                                               │
│  │                           │ EVENT PUBLISHING                              │
│  │                           ▼                                               │
│  │  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  │                        EVENT BUS                                  │   │
│  │  │  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  │  │                      Apache Kafka                             │   │
│  │  │  │                   (Port 9092)                                 │   │
│  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐   │   │
│  │  │  │  │ AccountOpened   │  │ FundsDeposited │  │ FundsWithdrawn   │   │
│  │  │  │  │ Event           │  │ Event           │  │ Event            │   │
│  │  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘   │   │
│  │  │  └─────────────────────────────────────────────────────────────────┘   │
│  │  └─────────────────────────────────────────────────────────────────────┘   │
│  │                           │                                               │
│  │                           │ EVENT CONSUMPTION                             │
│  │                           ▼                                               │
│  │  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  │                        QUERY SIDE (READ)                          │   │
│  │  │  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  │  │                    account-query (Port 5001)                   │   │
│  │  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐   │   │
│  │  │  │  │ AccountLookup   │  │ FindById       │  │ FindByHolder     │   │
│  │  │  │  │ Controller      │  │ Controller      │  │ Controller      │   │
│  │  │  │  └─────────────────┘  └─────────────────┘  └─────────────────┘   │   │
│  │  │  │                           │         │         │                   │   │
│  │  │  │                           └─────────┼─────────┘                   │   │
│  │  │  │                                     │                             │   │
│  │  │  │                    ┌────────────────▼────────────────┐            │   │
│  │  │  │                    │       Query Dispatcher          │            │   │
│  │  │  │                    └────────────────▲────────────────┘            │   │
│  │  │  │                             │         │                           │   │
│  │  │  │  ┌─────────────────┐  ┌──────▼─────┐  ┌─────────────────┐         │   │
│  │  │  │  │ Query Handlers  │  │ Repository │  │ Event Handler    │         │   │
│  │  │  │  │                 │  │ (MySQL)    │  │                 │         │   │
│  │  │  │  └─────────────────┘  └────────────┘  └─────────────────┘         │   │
│  │  └─────────────────────────────────────────────────────────────────────┘   │
│  └─────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      │ Database Operations
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                             DATA STORAGE                                  │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        DATABASES                                   │   │
│  │  ┌─────────────────────────────────┐  ┌─────────────────────────────┐ │   │
│  │  │          MongoDB                │  │          MySQL               │ │   │
│  │  │     (Command Side - Events)     │  │    (Query Side - Views)      │ │   │
│  │  │  ┌─────────────────────────────┐ │  │  ┌─────────────────────────┐ │ │   │
│  │  │  │ • Account Events            │ │  │  │ • BankAccount Table     │ │ │   │
│  │  │  │ • Transaction Events        │ │  │  │ • Account Projections   │ │ │   │
│  │  │  │ • Audit Trail               │ │  │  │ • Optimized Queries     │ │ │   │
│  │  │  └─────────────────────────────┘ │  │  └─────────────────────────┘ │ │   │
│  │  │         Port: 27017              │  │         Port: 3306           │ │   │
│  │  └─────────────────────────────────┘  └─────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

## Flow Legend

```
HTTP REQUESTS:
───────▶  Synchronous API calls
······▶  Asynchronous event flow

DATA FLOW:
═══════▶  Command flow (writes)
──────▶  Query flow (reads)
······▶  Event flow (async updates)

COMPONENTS:
┌─────┐   Service/Container
│ SVC │
└─────┘

┌─────┐   Database
│ DB  │
└─────┘

┌─────┐   External System
│ EXT │
└─────┘
```

## Key CQRS Concepts Illustrated

1. **Command-Query Separation**: Writes (commands) ≠ Reads (queries)
2. **Event Sourcing**: State changes stored as immutable events
3. **Eventual Consistency**: Query side updated asynchronously
4. **Materialized Views**: Optimized read models in separate database
5. **Domain-Driven Design**: Aggregates encapsulate business logic

## Service Ports

- **account-ui**: 3000 (React + Nginx)
- **account-cmd**: 5002 (Command Side)
- **account-query**: 5001 (Query Side)
- **kafka**: 9092 (Event Bus)
- **mongodb**: 27017 (Event Store)
- **mysql**: 3306 (Read Store)
- **zookeeper**: 2181 (Kafka coordination)